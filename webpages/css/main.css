body {
  font-family: "Arial", sans-serif;
  background: white;
  color: black;
  line-height: 125%;
  margin: 0;
  padding: 0;
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  align-items: stretch;
  min-width: 40em;
}

/* show/hide things depending on
 * - whether anyone is logged in
 * - who the page is about
 * - whether editing is enabled
 * - who is logged in and who the thing belongs to
 */
body.signed-on .when-signed-out,
body:not(.signed-on) .when-signed-on,
body:not(.page-about-you) .only-if-page-about-you,
body.page-about-you .only-if-page-not-about-you,
body:not(.editing) .editing,
body:not(.page-about-you) .editing,
body.editing.page-about-you .notediting,
.only-if-yours:not(.yours),
.only-not-yours.yours,
body.editing.page-about-you .notediting-or-not-yours.yours,
_ {
  display: none !important;
}

.loadingspinner { display: none !important; }

.loading .loadingspinner { display: block !important; }

/* from https://codepen.io/flesler/pen/AEIFc */
[contenteditable]:empty:before {
  content: attr(placeholder);
  color: #aaa;
  font-style: italic;
  display: inline-block;
}

[contenteditable] {
  white-space: pre-line; /* to use \n instead of <br> as newlines */
  min-width: 1em;
  min-height: 1em;
}

.edithighlight:hover [contenteditable]:not(.validationerror),
.edithighlight:hover ~ [contenteditable]:not(.validationerror),
[contenteditable]:hover:not(.validationerror) {
  box-shadow: 0 0 3px 3px rgba(66,133,244,.3);
}

[contenteditable]:focus.validationerror {
  outline: initial;
}

body > * {
  margin: .5rem;
}

body > header {
  display: flex;
  align-items: flex-start;
  justify-content: space-between;
  margin: 0;
}

body > header h1 {
  margin-bottom: 1em;
  line-height: 1.1em;
  margin-left: .5em;
}

body > footer {
  font-size: 85%;
  line-height: 120%;
  height: 5rem;
  background-color: #ddf;
  box-sizing: border-box;
  padding: 1em;
  margin: 0;
  margin-top: auto;
}

body > footer > p {
  margin: 0;
  padding: 0;
}

.limaversion .value {
  font-family: monospace;
}

/* popupbox
 *
 *
 *     #####   ####  #####  #    # #####  #####   ####  #    #
 *     #    # #    # #    # #    # #    # #    # #    #  #  #
 *     #    # #    # #    # #    # #    # #####  #    #   ##
 *     #####  #    # #####  #    # #####  #    # #    #   ##
 *     #      #    # #      #    # #      #    # #    #  #  #
 *     #       ####  #       ####  #      #####   ####  #    #
 *
 *
 */

.popupbox {
  display: none;
  position: fixed;
  top: 12em; /* todo better positioning, this is here to put it under the paper title */
  bottom: 0;
  right: 0;
  width: 15em;
  border-left: 1px solid black;
  border-top: 1px solid black;
  border-radius: .5em 0 0 0;
  padding: .3em .5em .1em .5em;
  background-color: white;
  text-align: left;
  overflow: auto;
  z-index: 10;
}

.popupbox > header,
.popupbox > footer {
  margin-bottom: .5em;
}

.popupbox > header {
  font-weight: bold;
  margin-right: 1.5em;
}

.popupbox > footer {
  font-size: 80%;
  line-height: 120%; /* coltype styling depends on this */
  margin-top: .5em;
  border-top: 1px solid #888;
  padding-top: .3em;
  margin-bottom: 0;
  padding-bottom: 0;
}


body:not(.boxpinned) .popupboxtrigger:hover .popupbox,
.popupbox.default {
  display: block;
}

.popupbox.default {
  font-style: italic;
  z-index: 1;
  color: #444;
  border-left: 1px solid #888;
  border-top: 1px solid #888;
}

.popupbox.default > * {
  font-size: 80%;
}

/* highlight the field whose popupbox is showing */
body:not(.boxpinned) .popupboxtrigger:hover .popupboxhighlight,
body:not(.boxpinned) .popupboxtrigger.popupboxhighlight:hover,
.popupboxtrigger.pinned .popupboxhighlight,
.popupboxtrigger.pinned.popupboxhighlight {
  background: rgba(128,0,255,.1);
}

/* don't highlight if we're hovering over the 'unhide' button */
body:not(.boxpinned) .popupboxtrigger:hover .unhide:hover + .popupboxhighlight {
  background: none;
}


.popupbox.pinned {
  box-shadow: 0 0 .3em .3em rgba(128,0,255,.2);
  display: block;
}

.popupbox .pin {
  display: block;
  font-size: 150%;
  font-weight: bold;
  color: #888;
  position: absolute;
  top: 0;
  right: 0;
  margin: .1em;
  padding: 0;
  text-align: center;
  min-width: 1em;
  line-height: 100%;
  border-radius: .2em;
}

.popupbox .pin:after {
  content: '▿';
  display: block;
  height: 100%;
  width: 100%;
}

.popupbox.pinned .pin:after {
  content: '×';
}

.popupbox .pin:hover {
  background: #888;
  color: white;
}



/* userinfo
 *
 *
 *     #    #  ####  ###### #####  # #    # ######  ####
 *     #    # #      #      #    # # ##   # #      #    #
 *     #    #  ####  #####  #    # # # #  # #####  #    #
 *     #    #      # #      #####  # #  # # #      #    #
 *     #    # #    # #      #   #  # #   ## #      #    #
 *      ####   ####  ###### #    # # #    # #       ####
 *
 *
 */

.userinfo {
  transition: border 1s;
  min-width: 50px;
  min-height: 50px;
  z-index: 100;
  background-color: white;
  margin: 0;
}

.userinfo .userphoto {
  max-height: 48px;
  max-width: 48px;
  margin: 12px;
  margin-bottom: -1px; /* to merge the border with the list of actions */
  border-radius: 12px;
  padding: 2px;
  display: block;
  border: 1px solid rgba(0,0,0,0);
  transition: .3s;
}

.userinfo .actions {
  visibility: hidden;
  padding: 0 .5em;
  border: 1px solid rgba(0,0,0,.5);
  border-radius: 12px;
  background: white;
  position: absolute;
  right: .5em;
  transition: .3s;
}

.userinfo .actions > * {
  margin: .5em 0;
  display: block;
  width: 100%;
  box-shadow: 0 0 0 0 rgba(66,133,244,.3);
  text-align: center;
}

.userinfo .actions > a,
.userinfo .username {
  text-decoration: none;
  color: black;
  line-height: 200%;
}

.userinfo .actions > a {
  cursor: pointer;
}

.userinfo .actions > a:hover {
  box-shadow: 0 0 3px 3px rgba(66,133,244,.3);
}

.userinfo:hover .actions {
  visibility: visible;
}

.userinfo:hover .userphoto {
  border: 1px solid rgba(0,0,0,.5);
}

body.new .userinfo #toggle-editing {
  display: none;
}

body.editing #toggle-editing .ifoff,
body:not(.editing) #toggle-editing .ifon {
  display: none;
}



/* personalinfo
 *
 *
 *   #####  ###### #####   ####   ####  #    #   ##   #      # #    # ######  ####
 *   #    # #      #    # #      #    # ##   #  #  #  #      # ##   # #      #    #
 *   #    # #####  #    #  ####  #    # # #  # #    # #      # # #  # #####  #    #
 *   #####  #      #####       # #    # #  # # ###### #      # #  # # #      #    #
 *   #      #      #   #  #    # #    # #   ## #    # #      # #   ## #      #    #
 *   #      ###### #    #  ####   ####  #    # #    # ###### # #    # #       ####
 *
 *
 */

section#personalinfo {
  width: 30em;
  text-align: center;
}

#personalinfo .photo {
  border-radius: .5em;
  border: 1px solid white;
  box-shadow: 0 0 3px 3px rgba(0,0,0,.3);
}

#personalinfo.loading .email,
#personalinfo.loading .joined {
  display: none;
}




/* lists
 *
 *
 *         #      #  ####  #####  ####
 *         #      # #        #   #
 *         #      #  ####    #    ####
 *         #      #      #   #        #
 *         #      # #    #   #   #    #
 *         ###### #  ####    #    ####
 *
 *
 */
section.list {
  display: block;
  border: 1px solid black;
  margin-bottom: 1em;
  position: relative;
  width: 30em;
  z-index: 0;
}

section.list > header {
  display: block;
  margin: 0;
  padding: 0 0 0 .5em;
  border-bottom: 1px solid black;
  height: 2em;
  background: #eee;
}

section.list > header h2 {
  font-size: 1.5em;
  line-height: 130%;
  margin: 0;
}

section.list > header .filter {
  display: block;
  position: absolute;
  top: 0;
  right: 0;
  padding: .2em;
  border: 1px solid black;
  margin: .1em;
  background: white;
  text-align: right;
  z-index: 1;
}

section.list > header .filter .options {
  display: none;
  text-align: left;
  margin: .5em;
  padding: 0;
}

section.list > header .filter .options + .options {
  border-top: 1px solid #eee;
}


section.list > header .filter:hover .options {
  display: block;
}

section.list > header .filter .options li {
  display: block;
  padding: 0;
  margin: .5em 0;
}

section.list footer {
  display: block;
  margin: 0;
  padding: 0 0 0 .5em;
  border-top: 1px solid black;
  height: 2em;
  background: #eee;
}

section.list footer .add {
  position: absolute;
  bottom: 0;
  right: 0;
  padding: 0;
  border: 1px solid black;
  background: white;
  text-align: center;
  width: 1em;
  font-size: 1.65em;
  line-height: 100%;
  margin: .0606em;
  text-decoration: none;
  color: black;
}

section.list > ul {
  margin: 0;
  padding: .25em;
  display: block;
}

section.list > ul > li {
  margin: 0;
  padding: .25em;
  display: block;
  border-bottom: 1px solid #eee;
  position: relative;
}

section.list > ul > li:hover:not(.empty):not(.loading) {
  background: #ddf;
}

section.list > ul > li.empty {
  font-style: italic;
}

section.list > ul > li:last-of-type {
  border-bottom: 0;
}

section.list > ul > li .name {
  display: inline-block;
}

section.list > ul > li .mainlink {
  text-decoration: none;
  color: inherit;
}

section.list > ul > li > .date {
  display: inline-block;
  margin-left: 2em;
  float: right;
}

section.list > ul > li .reference {
  font-size: .8em;
  margin-left: 4em;
  white-space: nowrap;
  text-overflow: ellipsis;
  overflow: hidden;
}

section.list > ul > li > header {
  display: flex;
  justify-content: space-between;
}

section.list > ul > li > .description {
  font-size: .8em;
  white-space: nowrap;
  text-overflow: ellipsis;
  overflow: hidden;
  display: block;
}

section.list > ul > li > ul.tags {
  display: block;
  margin: 0;
  padding: 0;
}

section.list > ul > li > ul.tags > li {
  font-size: .7em;
  display: inline-block;
  margin: .2em;
  padding: .4em;
  line-height: 100%;
  border: 1px solid #008;
  border-radius: .4em;
  background: #33c;
  color: white;
}


/* papers
 *
 *
 *         #####    ##   #####  ###### #####   ####
 *         #    #  #  #  #    # #      #    # #
 *         #    # #    # #    # #####  #    #  ####
 *         #####  ###### #####  #      #####       #
 *         #      #    # #      #      #   #  #    #
 *         #      #    # #      ###### #    #  ####
 *
 *
 */

#paper {
  min-width: 40em;
}

/* make space for the boxes on the right-hand side of the page */
#paper > :not(header) {
  margin: .5em 16em 0 0;
}

#paper .reference .value,
#paper .description .value {
  white-space: pre-line;
  display: inline-block;
  vertical-align: top;
  max-width: 30em;
}

#paper .link .value {
  white-space: nowrap;
  display: inline-block;
  vertical-align: top;
  max-width: 30em;
  overflow: hidden;
  text-overflow: ellipsis;
}

#paper .link .editing:focus {
  white-space: pre-line;
  overflow: visible;
  text-overflow: unset;
}

#paper > header {
  background: #ddf;
  margin: 0;
  padding: .5em;
  position: relative;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

#paper > header h1 {
  line-height: 100%;
  margin: 0;
  padding: 0;
  flex: 0 0 auto;
}

#paper .exptitle.editing,
#paper .coltitle.editing {
  display: inline-block;
}

#paper .unhide {
  display: none;
}

#paper .lastcolumnhidden .unhide {
  color: rgba(0, 0, 0, 0.26);
  border: 1px solid rgba(0,0,0,0);
  display: inline-block;
  position: absolute;
  left: -.7px;
  top: 0;
  transform: translate(-50%,-50%)translate(9.5em,-9.5em)rotate(45deg);
  font-size: 80%;
  z-index: 1;
}

#paper th.characteristic + th.result .unhide {
  left: -1.4px;
}


#paper .lastcolumnhidden .unhide:hover {
  color: rgba(0, 0, 0, 1);
  cursor: pointer;
  background: rgba(255,255,255,.7);
  border: 1px solid rgba(0,0,0,.7);
  border-radius: .2em;
}

#paper .popupboxhighlight .coltitle:empty:before {
  content: 'enter title';
  color: #aaa;
  font-style: italic;
  display: inline-block;
}

#paper > header .title.editing.unsaved:not(.validationerror):not(:focus),
#paper .exptitle.editing.unsaved:not(.validationerror):not(:focus),
#paper .coltitle.editing.unsaved:not(.validationerror):not(:focus),
#paper .linkedit .value.editing.unsaved:not(.validationerror):not(:focus) {
  box-shadow: 0 0 3px 3px rgba(255,0,0,.5);
}

#paper > header button.titlerename,
#paper button.coltitlerename,
#paper button.exptitlerename {
  margin-right: auto;
  opacity: 0;
  transition: opacity .2s .2s;
  margin-left: 1em;
  position: relative;
}

#paper button.coltitlerename {
  display: none;
}

#paper .fullrowinfo header,
#paper .fullcolinfo header,
#paper .colinfo header {
  padding-top: 1em;
  position: relative;
}

body.page-about-you.editing .fullcolinfo header {
  margin-right: 0;
}

#paper .fullcolinfo header p,
#paper .colinfo header p,
#paper .fullrowinfo header p {
  display: inline-block;
  margin: 0;
}

#paper .titlerenamewarning {
  position: absolute;
  left: 2em;
  right: 2em;
  top: 150%;
  background: white;
  border: 1px solid black;
  border-radius: 1em;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 3em 3em;
  z-index: 20;
  box-shadow: 0 0 .3em .3em rgba(128,0,255,.2);

  visibility: hidden;
}

#paper .exprenamewarning,
#paper .colrenamewarning {
  position: absolute;
  left: 1em;
  right: 1em;
  top: 100%;
  margin-top: 1em;
  background: white;
  border: 1px solid black;
  border-radius: .4em;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 1em 1em;
  z-index: 20;
  box-shadow: 0 0 .3em .3em rgba(128,0,255,.2);
  font-weight: normal;
  font-size: 80%;

  visibility: hidden;
}

#paper .exprenamewarning {
  right: -.875em; /* to offset the header's 1.5em right margin due to the pin button */
}

#paper .titlerenamewarning h1,
#paper .exprenamewarning h1,
#paper .colrenamewarning h1 {
  margin-bottom: 1em;
}

#paper .exprenamewarning h1,
#paper .colrenamewarning h1 {
  font-size: 1.2em;
  font-weight: normal;
}

#paper > header .title.editing.unsaved ~ .titlerenamewarning,
#paper .coltitle.editing.unsaved ~ .exprenamewarning,
#paper th:not(.newcol) .coltitle.editing.unsaved ~ .colrenamewarning {
  transition: visibility 0s 1s;
}

#paper > header .title.editing.unsaved:focus ~ .titlerenamewarning,
#paper > header .title.editing.unsaved:hover ~ .titlerenamewarning,
#paper > header .title.editing.unsaved + .titlerename:hover ~ .titlerenamewarning,
#paper > header .title.editing.unsaved + .titlerename:focus ~ .titlerenamewarning,
#paper > header .title.editing.unsaved ~ .titlerenamewarning:hover,
#paper .exptitle.editing:not(.new).unsaved:focus ~ .exprenamewarning,
#paper .exptitle.editing:not(.new).unsaved:hover ~ .exprenamewarning,
#paper .exptitle.editing:not(.new).unsaved + .exptitlerename:hover ~ .exprenamewarning,
#paper .exptitle.editing:not(.new).unsaved + .exptitlerename:focus ~ .exprenamewarning,
#paper .exptitle.editing:not(.new).unsaved ~ .exprenamewarning:hover,
#paper th:not(.newcol) .coltitle.editing.unsaved:focus ~ .colrenamewarning,
#paper th:not(.newcol) .coltitle.editing.unsaved:hover ~ .colrenamewarning,
#paper th:not(.newcol) .coltitle.editing.unsaved + .coltitlerename:hover ~ .colrenamewarning,
#paper th:not(.newcol) .coltitle.editing.unsaved + .coltitlerename:focus ~ .colrenamewarning,
#paper th:not(.newcol) .coltitle.editing.unsaved ~ .colrenamewarning:hover {
  visibility: visible;
  transition: visibility 0s;
}

#paper > header .title.editing.unsaved:not(.validationerror):not(:focus) + button.titlerename:not(:focus):before,
#paper .coltitle.editing.unsaved:not(.validationerror):not(:focus) + button.coltitlerename:not(:focus):before,
#paper .exptitle.editing.unsaved:not(.validationerror):not(:focus) + button.exptitlerename:not(:focus):before {
  content: 'click the button to confirm';
  display: block;
  position: absolute;
  top: -2em;
  right: 0;
  left: auto;
  font-size: .6rem;
  font-weight: normal;
  color: #a00;
  background: white;
}

#paper .linkedit button.confirm {
  position: relative;
}

#paper .linkedit span.editing.unsaved:not(.validationerror):not(:focus) ~ button.confirm:not(:focus):before {
  content: 'click the button to save';
  display: block;
  position: absolute;
  top: -1.2em;
  left: 0;
  right: auto;
  font-size: .6rem;
  font-weight: normal;
  color: #a00;
  background: white;
}

#paper .coltitle.editing.unsaved:not(.validationerror):not(:focus) + button.coltitlerename:not(:focus):before,
#paper .exptitle.editing.unsaved:not(.validationerror):not(:focus) + button.exptitlerename:not(:focus):before {
  right: auto;
  left: 100%;
  top: auto;
  bottom: 0;
  margin-left: 1em;
}

#paper > header h1.title:hover + button.titlerename,
#paper > header h1.title:focus + button.titlerename,
#paper > header h1.title + button.titlerename:enabled,
#paper > header h1.title + button.titlerename:hover,
#paper .exptitle.editing:hover + button.exptitlerename,
#paper .exptitle.editing:focus + button.exptitlerename,
#paper .exptitle.editing + button.exptitlerename:enabled,
#paper .exptitle.editing + button.exptitlerename:hover {
  opacity: 1;
  transition: opacity 0s;
}

#paper .coltitle.editing:hover + button.coltitlerename,
#paper .coltitle.editing:focus + button.coltitlerename,
#paper .coltitle.editing + button.coltitlerename:enabled,
#paper .coltitle.editing + button.coltitlerename:hover {
  opacity: 1;
  display: inline-block;
}

#paper > header ul.tags {
  display: inline-block;
  margin: 0 0 0 2em;
  padding: 0;
  vertical-align: bottom;
  flex: 0 1 auto;
  text-align: right;
}

#paper ul.tags > li {
  font-size: .7em;
  display: inline-block;
  margin: .2em;
  padding: 0;
  line-height: 100%;
  border: 1px solid #008;
  border-radius: .4em;
  background: #33c;
  transition: background .5s;
  color: white;
  overflow: hidden;
  vertical-align: bottom;
}

#paper ul.tags > li.flash {
  background: #ff0;
}

#paper ul.tags > li.new {
  background: white;
  color: black;
}

#paper ul.tags > li.new [contenteditable] {
  text-align: left;
}

#paper ul.tags > li.new [contenteditable]:focus {
  outline: initial;
  /* todo something in firefox puts the cursor too high */
}

#paper ul.tags > li.new:not(.editing) {
  display: none;
}

#paper ul.tags > li .tag {
  display: inline-block;
  margin: .4em;
}

#paper ul.tags > li .removetag {
  background-color: #226;
  color: white;
  display: inline-block;
  margin: 0;
  padding: .4em;
}

#paper ul.tags > li .removetag:hover {
  background-color: rgba(255,255,255,1);
  color: black;
}

#paper ul.tags > li.addtag {
  background: #3c3;
  transition: background 0s;
  color: white;
}

#paper ul.tags > li.new.editing + li.addtag {
  display: none;
}

#paper ul.tags.empty > li.addtag .notempty,
#paper ul.tags:not(.empty) > li.addtag .empty {
  display: none;
}

#paper ul.tags .addtag:hover {
  background-color: rgba(255,255,255,1);
  color: black;
}

#paper > header .savepending,
#paper > header .saving {
  font-style: italic;
  color: #444;
  position: absolute;
  right: 0;
  bottom: 120%;
  display: none;
}

#paper > header .unsavedmessage,
#paper > header .validationerrormessage {
  font-style: italic;
  color: #a00;
  position: absolute;
  right: 0;
  bottom: 120%;
  display: none;
  cursor: pointer;
}

#paper > header .savingerror {
  font-weight: bold;
  color: black;
  background: #f66;
  padding: .5em .8em;
  border-radius: .4em;
  position: absolute;
  right: 0;
  bottom: 100%;
  display: none;
}

#paper > header .edityourcopy {
  color: black;
  font-style: italic;
  padding: .5em .8em;
  margin: .5em 0 0 0;
  border-radius: .4em;
  background: white;
  border: 2px solid #ddf;
  position: absolute;
  right: 0;
  top: 100%;
  font-size: 80%;
  display: none;
}

#paper > header .edityourcopy a {
  text-decoration: none;
  color: inherit;
}

#paper > header .edityourcopy:hover {
  background: #ddf;
}

body:not(.page-about-you).signed-on #paper > header .edityourcopy {
  display: block;
}

#paper.saving > header .saving,
#paper.savepending:not(.saving) > header .savepending,
#paper.validationerror > header .validationerrormessage,
#paper:not(.validationerror):not(.saving):not(.savepending).unsaved > header .unsavedmessage {
  display: block;
}

#paper:not(.unsaved):not(.validationerror) .when-unsaved,
#paper.unsaved .not-unsaved,
#paper.validationerror .not-unsaved {
  display: none;
}

#paper.savingerror > header .savingerror { display: block; cursor: pointer; }

#paper .linkedit > a.value ~ button.editing {
  display: none;
  vertical-align: middle;
  margin-left: .3em;
}

#paper .linkedit > a.value ~ button.test,
#paper .linkedit > a.value ~ span.editing.unsaved ~ button.editing,
#paper .linkedit > a.value ~ span.editing:focus ~ button.test {
  display: inline-block;
}

#paper .linkedit > a.value ~ span.editing:empty ~ button.test {
  display: none;
}

.savingspinner { display: none !important; }

#paper.editing-disabled-by-saving ~ .savingspinner {
  display: block !important;
  font-size: 200%;
  font-style: italic;
  font-weight: normal;
  position: fixed;
  padding: 1em;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
  background-color: #ddf;
  border-radius: 1em;
  box-shadow: 0 0 1em 1em #ddf;
  color: #646;
}

#paper.editing-disabled-by-saving { opacity: .5; transition: opacity .3s; }



/* experiment data
 *
 *
 *  ###### #    # #####  ###### #####  # #    # ###### #    # #####    #####    ##   #####   ##
 *  #       #  #  #    # #      #    # # ##  ## #      ##   #   #      #    #  #  #    #    #  #
 *  #####    ##   #    # #####  #    # # # ## # #####  # #  #   #      #    # #    #   #   #    #
 *  #        ##   #####  #      #####  # #    # #      #  # #   #      #    # ######   #   ######
 *  #       #  #  #      #      #   #  # #    # #      #   ##   #      #    # #    #   #   #    #
 *  ###### #    # #      ###### #    # # #    # ###### #    #   #      #####  #    #   #   #    #
 *
 *
 */

/* rotated headings inspired by https://css-tricks.com/rotated-table-column-headers/ */

#paper table.experiments {
  text-align: center;
  margin-right: 0em;
  margin-top: 10em;
  border-spacing: 0;
  padding-right: 23em; /* 15em for width of popupbox and 8em for width of overhanging column labels and new column box */
}

#paper.no-data table.experiments {
  padding-right: 17em; /* 15em for width of popupbox and 2em for extra gap */
}

body.addnewcolumn #paper table.experiments {
  padding-right: 35em; /* 15em for width of popupbox and 22em for width of new column box */
}

#paper .no-table {
  display: none;
}

body:not(.page-about-you) #paper.no-data .no-table,
body:not(.editing) #paper.no-data .no-table {
  display: block;
  padding: .5em;
  border: 1px solid black;
}

#paper table.experiments th {
  font-weight: normal;
  vertical-align: top;
  padding: .3em .5em;
}

#paper table.experiments tr:first-child th {
  padding: 0;
  min-width: 2.5em;
  height: 1em;
  vertical-align: bottom;
  text-align: center;
  position: relative;
  border-right: 1px solid black;
}

#paper table.experiments tr th:first-child {
  border-right: 2px solid black;
  position: relative;
  position: -webkit-sticky;
  position: -moz-sticky;
  position: -ms-sticky;
  position: -o-sticky;
  position: sticky;
  left: 0;
  z-index: 1;
}

#paper table.experiments tr th:first-child {
  background: white;
}

#paper table.experiments tr th:first-child .expdescription.short {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  max-width: 8em;
  max-height: 1em;
  line-height: 1em;
  font-size: 90%;
}

#paper table.experiments .fullrowinfo .expdescription:not([contenteditable]):empty:before {
  content: 'No detailed description';
  color: #aaa;
  font-style: italic;
  display: inline-block;
}

/* nth-last-child(2) because there's the heading for adding */
#paper table.experiments tr:first-child th:last-child,
body:not(.page-about-you) #paper table.experiments tr:first-child th:nth-last-child(2),
body:not(.editing) #paper table.experiments tr:first-child th:nth-last-child(2) {
  border-right: none;
}

#paper table.experiments tr:first-child th > div:not(.popupbox):not(.unhide):not(.addcolumnbox) {
  transform: translate(-.5em,.8em) rotate(-45deg);
  transform-origin: top left;
  display: inline-block;
  position: absolute;
  bottom: 1em;
}

body.page-about-you.editing #paper table.experiments tr:first-child th:not(:last-child):after,
body:not(.page-about-you) #paper table.experiments tr:first-child th:not(:nth-last-child(-n+2)):after,
body:not(.editing) #paper table.experiments tr:first-child th:not(:nth-last-child(-n+2)):after {
  border-top: 1px solid black;
  display: block;
  content: ' ';
  position: absolute;
  right: 0;
  bottom: 1em;
  width: 12em;
  transform: rotate(135deg);
  transform-origin: bottom right;
}

/* thicker first column divider line */
#paper table.experiments tr:first-child th:first-child:after {
  border-top: 2px solid black !important;
}

/* give the first column white background so it hides stuff under it in case of position:sticky working */
#paper table.experiments tr:first-child th:first-child:before {
  border-top: 100em solid white;
  display: block;
  content: ' ';
  position: absolute;
  right: 0;
  bottom: 1em;
  width: 12.7em;
  transform: rotate(135deg)skew(45deg)translateY(100em);
  transform-origin: bottom right;
}

/* thicker line between characteristics and results columns */
#paper table.experiments tr:first-child th.characteristic + th.result,
#paper table.experiments tr td.characteristic + td.result {
  border-left: 2px solid black;
}
#paper table.experiments tr:first-child th.characteristic + th.result:before {
  border-bottom: 2px solid black;
  display: block;
  content: ' ';
  position: absolute;
  left: 0;
  bottom: 1em;
  width: 12em;
  transform: translate(-.5px,1px) rotate(-45deg);
  transform-origin: bottom left;
}


#paper table.experiments tr:first-child th > div > span {
  width: 12em;
  white-space: nowrap;
  text-overflow: ellipsis;
  overflow: hidden;
  display: block;
  text-align: left;
  font-weight: bold;
}

#paper table.experiments .fullcolinfo footer {
  position: relative;
}

#paper table.experiments .fullcolinfo .coltype {
  position: relative;
}

#paper table.experiments .fullcolinfo .coltype.result .type-characteristic,
#paper table.experiments .fullcolinfo .coltype.result ~ * .type-characteristic,
#paper table.experiments .fullcolinfo .coltype.characteristic .type-result,
#paper table.experiments .fullcolinfo .coltype.characteristic ~ * .type-result,
#paper table.experiments .colinfo .coltype.result .type-characteristic,
#paper table.experiments .colinfo .coltype.characteristic .type-result {
  display: none;
}

#paper table.experiments th.newcol .fullcolinfo .type-characteristic,
#paper table.experiments th.newcol .fullcolinfo .type-result {
  font-weight: bold;
}

body.editing #paper table.experiments .fullcolinfo .coltype.yours .type-characteristic,
body.editing #paper table.experiments .fullcolinfo .coltype.yours .type-result {
  border: 1px solid transparent;
  border-radius: .5em;
  background: none;
  padding: .5em;
  position: relative;
  top: 0px;
  left: calc(-.5em - 1px);
}

body.editing #paper table.experiments .fullcolinfo .coltype.yours .aftertype {
  background: none;
  margin-left: calc(-.5em - .5em - 1px - 1px); /* moving towards the type text which is laid out to have .5em horizontal padding and 1px border */
}

body.editing #paper table.experiments .fullcolinfo .coltype.yours:hover .type-result,
body.editing #paper table.experiments .fullcolinfo .coltype.yours:hover .type-characteristic {
  border: 1px solid black;
  background: white;
  z-index: 2;
  box-shadow: 0 0 3px 3px rgba(66,133,244,.3);
}

body.editing #paper table.experiments .fullcolinfo .coltype.yours.result:hover .type-characteristic,
body.editing #paper table.experiments .fullcolinfo .coltype.yours.characteristic:hover .type-result {
  position: absolute;
  top: calc(-2.2em - .5em - 1px);
  display: inline;
  z-index: 1;
}

body.editing #paper:not(.unsaved):not(.validationerror) table.experiments .fullcolinfo .coltype.newcol.when-unsaved,
body.editing #paper.unsaved table.experiments .fullcolinfo .coltype.newcol.not-unsaved,
body.editing #paper.validationerror table.experiments .fullcolinfo .coltype.newcol.not-unsaved {
  display: initial;
}

body.editing #paper:not(.unsaved):not(.validationerror) table.experiments .fullcolinfo .coltype.newcol.not-unsaved,
body.editing #paper.unsaved table.experiments .fullcolinfo .coltype.newcol.when-unsaved,
body.editing #paper.validationerror table.experiments .fullcolinfo .coltype.newcol.when-unsaved {
  display: none;
}

body.editing #paper table.experiments .fullcolinfo .coltype:not(.when-unsaved).yours.result .type-characteristic:hover,
body.editing #paper table.experiments .fullcolinfo .coltype:not(.when-unsaved).yours.characteristic .type-result:hover {
  background: rgba(243,230,255,1);
  cursor: pointer;
  z-index: 3;
}

body.editing #paper table.experiments .fullcolinfo .coltype.yours.result .type-result,
body.editing #paper table.experiments .fullcolinfo .coltype.yours.characteristic .type-characteristic {
  border-top-left-radius: 0;
}
body.editing #paper table.experiments .fullcolinfo .coltype.yours.result .type-result {
  border-top-right-radius: 0;
}
body.editing #paper table.experiments .fullcolinfo .coltype.yours.result .type-characteristic,
body.editing #paper table.experiments .fullcolinfo .coltype.yours.characteristic .type-result {
  border-bottom-left-radius: 0;
}
body.editing #paper table.experiments .fullcolinfo .coltype.yours.characteristic .type-result {
  border-bottom-right-radius: 0 0;
}

#paper table.experiments .fullcolinfo .coltypeconfirm {
  position: absolute;
  left: 1em;
  right: 1em;
  top: 100%;
  margin-top: 1em;
  background: white;
  border: 1px solid black;
  border-radius: .5em;
  box-shadow: 0 0 .3em .3em rgba(128,0,255,.2);
  padding: 0 1em 1em 1em;

  display: none;
}

#paper table.experiments .fullcolinfo .coltypeconfirm .type-characteristic,
#paper table.experiments .fullcolinfo .coltypeconfirm .type-result {
  font-weight: bold;
}

#paper table.experiments .fullcolinfo .coltype.unsaved ~ .coltypeconfirm {
  display: block;
}

#paper table.experiments .fullcolinfo .value,
#paper table.experiments .colinfo .value {
  white-space: nowrap;
}

#paper table.experiments .colinfo:not(.unpopulated) .unpopulated,
#paper table.experiments .colinfo.unpopulated :not(.unpopulated):not(header) {
  display: none;
}

#paper table.experiments .colinfo:not(.alreadythere) .alreadythere {
  display: none;
}

#paper table.experiments .colinfo .alreadythere {
  font-style: italic;
  font-weight: normal;
}

#paper table.experiments tr:first-child th.add .addcolumnbox {
  transform: none;
  position: absolute;
  top: -10em;
  left: -1em;
  z-index: 10;
  height: 20em;
  width: 25em;
  background: white;
  border: 1px solid black;
  border-radius: .5em;
  display: flex;
  flex-direction: column;
  align-items: stretch;
  justify-content: space-between;
  font-size: 80%;
  padding: 1em;
  text-align: left;
}

#paper table.experiments tr:first-child th.add:not(.adding) .addcolumnbox,
#paper table.experiments tr:first-child th.add:not(.adding) .colinfo {
  display: none;
}

#paper table.experiments tr:first-child th.add .addcolumnbox header,
#paper table.experiments tr:first-child th.add .addcolumnbox footer {
  display: flex;
  flex-direction: row;
  flex-wrap: wrap;
  justify-content: space-between;
  flex: 0 0 auto;
}

#paper table.experiments tr:first-child th.add .addcolumnbox header span.search {
  flex: 1 0 5em;
  margin-left: auto;
  padding-left: 1em;
  max-width: 10em;
}

#paper table.experiments tr:first-child th.add .addcolumnbox header input.search {
  width: 100%;
}

#paper table.experiments tr:first-child th.add .addcolumnbox h1 {
  font-size: 120%;
  margin: 0;
  flex: 0 0 auto;
}

#paper table.experiments tr:first-child th.add .addcolumnbox > ul {
  overflow: auto;
  margin: .5em 0;
  padding: 0;
}

#paper table.experiments tr:first-child th.add .addcolumnbox > ul > li {
  overflow: auto;
  display: flex;
  justify-content: space-between;
  margin: 0;
  padding: .2em .3em .2em 2em;
}

#paper table.experiments tr:first-child th.add .addcolumnbox > ul > li:last-child {
  border-bottom: 1px solid #888;
}

#paper table.experiments tr:first-child th.add .addcolumnbox > ul > li:hover:not(.heading):not(.alreadythere) {
  background: rgba(243,230,255,1);
}

#paper table.experiments tr:first-child th.add .addcolumnbox > ul > li.alreadythere {
  background-color: #eee;
}

#paper table.experiments tr:first-child th.add .addcolumnbox > ul > li.alreadythere:hover {
  background: rgba(228,215,240,1);
}

#paper table.experiments tr:first-child th.add .addcolumnbox > ul > li.heading {
  padding: .3em;
  /*font-weight: bold;*/
  background: rgba(128,0,255,.05);
  border-top: 1px solid black;
}

#paper table.experiments tr:first-child th.add .addcolumnbox > ul > li > .coltitle {
  overflow: hidden;
  text-overflow: ellipsis;
  flex: 1 1 auto;
  white-space: nowrap;
}

#paper table.experiments tr:first-child th.add .addcolumnbox > ul > li.alreadythere > .coltitle {
  color: #444;
  font-style: italic;
}

#paper table.experiments tr:first-child th.add .addcolumnbox > ul > li:not(.alreadythere) > .coltitle {
  cursor: pointer;
}

#paper table.experiments tr:first-child th.add .addcolumnbox > ul > li > .definedby {
  display: block;
  flex: 0 0 auto;
  font-size: 67%;
}

#paper table.experiments tr:first-child th.add .addcolumnbox:not(.loading) > ul:empty:after {
  display: block;
  content: 'error: no columns available';
}

#paper table.experiments td {
  padding: .3em .5em;
  vertical-align: top;
  border-right: 1px solid black;
  position: relative;
}

#paper table.experiments td.newcol {
  background-color: #ddd;
}

#paper table.experiments td.newcol > *:not(.newcol) {
  display: none !important;
}

#paper table.experiments td.newcol > .newcol {
  display: block;
  position: absolute;
  top: 0;
  bottom: 0;
  left: 0;
  right: 0;
}

#paper table.experiments td:not(.newcol) > .newcol {
  display: none;
}

#paper table.experiments td span[contenteditable] {
  min-width: 1em;
  min-height: 1em;
  display: inline-block;
}

#paper table.experiments td.hascomments:after {
  display: block;
  content: ' ';
  position: absolute;
  top: 0;
  right: 0;
  height: 0;
  width: 0;
  border-top: .5em solid #f50;
  border-left: .5em solid transparent;
}

#paper table.experiments .datum.popupbox .value:empty:before {
  content: 'no value';
  color: #aaa;
  font-style: italic;
  display: inline-block;
}

#paper table.experiments .datum.popupbox .by {
  font-size: 90%;
  font-weight: normal;
}

#paper table.experiments .datum.popupbox .comment {
  display: block;
  border-top: 1px solid black;
  margin: .5em 0;
  padding: .5em 0 0 0;
}

#paper table.experiments td:not(.hascomments) .datum.popupbox .comment.new {
  border-top: none;
}

#paper table.experiments .datum.popupbox .comment header {
  font-size: 90%;
  line-height: 120%;
  margin-bottom: .5em;
}

#paper table.experiments .datum.popupbox .comment .text {
  display: block;
}

#paper table.experiments .datum.popupbox .comment .ctime {
  white-space: nowrap;
}

#paper table.experiments .datum.popupbox .comment button.edit-button {
  float: right;
  visibility: hidden;
}

#paper table.experiments .datum.popupbox .comment:hover button.edit-button {
  visibility: visible;
}

#paper table.experiments .datum.popupbox .comment.new .text:not(:focus):empty + .buttons {
  display: none;
}


#paper table.experiments td.empty .datum.popupbox .by {
  display: none;
}

body:not(.page-about-you) #paper table.experiments td:last-child,
body:not(.editing) #paper table.experiments td:last-child {
  border-right: none;
}

#paper table.experiments tr:nth-child(2n),
#paper table.experiments tr:nth-child(2n) th:first-child {
  background-color: #eee;
}

/* fix highlighting of the row headings which have their own background */
body:not(.boxpinned) #paper table.experiments tr th:first-child.popupboxtrigger:hover .popupboxhighlight,
body:not(.boxpinned) #paper table.experiments tr th:first-child.popupboxtrigger.popupboxhighlight:hover,
#paper table.experiments tr th:first-child.popupboxtrigger.pinned .popupboxhighlight,
#paper table.experiments tr th:first-child.popupboxtrigger.pinned.popupboxhighlight {
  background: rgba(243,230,255,1);
}
body:not(.boxpinned) #paper table.experiments tr:nth-child(2n) th:first-child.popupboxtrigger:hover .popupboxhighlight,
body:not(.boxpinned) #paper table.experiments tr:nth-child(2n) th:first-child.popupboxtrigger.popupboxhighlight:hover,
#paper table.experiments tr:nth-child(2n) th:first-child.popupboxtrigger.pinned .popupboxhighlight,
#paper table.experiments tr:nth-child(2n) th:first-child.popupboxtrigger.pinned.popupboxhighlight {
  background: rgba(228,215,240,1);
}


body:not(.page-about-you) #paper table.experiments tr.add,
body:not(.page-about-you) #paper table.experiments th.add,
body:not(.editing) #paper table.experiments tr.add,
body:not(.editing) #paper table.experiments th.add,
body.page-about-you.editing #paper.no-data table.experiments th.add {
  display: none;
}

#paper table.experiments th.add > div > span {
  padding-left: .5em;
}

#paper table.experiments .add button {
  margin: .3em 0;
  white-space: nowrap;
}

body:not(.editing) #paper.no-data table.experiments,
body:not(.page-about-you) #paper.no-data table.experiments {
  display: none;
}

#paper:not(.no-data) table.experiments tr.add .no-data {
  display: none;
}

#paper.no-data table.experiments tr.add .no-data {
  border: none;
}

#paper .option-not-checked {
  display: none;
}

#paper .colformulacolumnsselection label,
#paper .colformulacolumnsselection label > select {
  display: block;
}

#paper td.datum.computed .notcomputed,
#paper td.datum:not(.computed) .computed {
  display: none;
}

/* validation
 *
 *
 *           #    #   ##   #      # #####    ##   ##### #  ####  #    #
 *           #    #  #  #  #      # #    #  #  #    #   # #    # ##   #
 *           #    # #    # #      # #    # #    #   #   # #    # # #  #
 *           #    # ###### #      # #    # ######   #   # #    # #  # #
 *            #  #  #    # #      # #    # #    #   #   # #    # #   ##
 *             ##   #    # ###### # #####  #    #   #   #  ####  #    #
 *
 *
 */
[contenteditable].validationerror {
  box-shadow: 0 0 3px 3px rgba(255,0,0,.5);
  position: relative;
}

[contenteditable].validationerror[data-validationmessage]:after {
  font-size: .8rem;
  font-weight: normal;
  display: block;
  position: absolute;
  left: 100%;
  bottom: 0;
  white-space: nowrap;
  padding-left: 1em;
  padding-right: 1em;
  margin-left: .5em;
  color: #a00;
  background: rgba(255,255,255,.9);
  content: attr(data-validationmessage);
  z-index: 20;
}
